<!DOCTYPE html>
<html>
<head>
    <meta charset= "utf-8">
    <meta name = "viewport" content = "initial-scale = 1, maximum-scale=1, user-scalable=no">
    <title>Final Project</title>
<style>
    html,
    body
      {
        margin: 0;
        height: 100%;
        width: 100%;
        background-color: black;
        color: white;
        font-family: sans-serif;
        font-size: 1rem;
    }
    #header {
        width: 100%;
        background-color: black;
        color: white;
        text-align: center;
        padding: .5em 2vw;
        box-sizing: border-box;
}

#header h1 {
        font-size: clamp(1rem, 2.5vw, 1.8rem);
        margin: 0;
        line-height: 1.3;
        font-weight: 600;
}
    .subtitle {
        position: absolute;
        top: 1vh;
        right: 1vw;
        color: black;
        font-style: bold;
        font-size: 1.2 rem;
        padding: 0.4em 0.7em;
        z-index: 10;
        width: auto;
        max-width: 80%;
        text-align: center;
    }
    #legendContainer {
        position: absolute;
        top: 8%;
        left: 0;
        height: 85%;
        width: 14.2%;
        background-color: rgba(0,0,0,0.85);
        border-right: 0.2em solid white;
        color: white;
        overflow-y: auto;
        padding: 1em;
        z-index: 9999;
    }
    #legendContainer h2 {
        font-size: 1.25rem;
        text-align: center;
        margin-bottom: 1em;
        border-bottom: 0.1em solid white;
        width: 100%
    }
     #incomeMap {
        position: absolute;
        top: 8%;
        left: 17%;
        height: 45%;
        width: 42%;
        border: 0.2em solid white;
            }
    #internetMap {
        position: absolute;
        top: 8%;
        right: 0;
        height: 45%;
        width: 40%;
        border: 0.2em solid white;
            }
    #graduatedMap {
        position: absolute;
        bottom: .5%;
        left: 17%;
        height: 45%;
        width: 42%;
        border: 0.2em solid white;
            }
    #passingMap {
        position: absolute;
        bottom: .5%;
        right: 0;
        height: 45%;
        width: 40%;
        border: 0.2em solid white;
            }
    
</style>
    <link rel="stylesheet" href="https://js.arcgis.com/4.34/esri/themes/light/main.css">
    <script src="https://js.arcgis.com/4.34"></script>
    <script>
require([
  "esri/Map",
  "esri/views/MapView",
  "esri/layers/GeoJSONLayer",
  "esri/renderers/ClassBreaksRenderer",
  "esri/widgets/LayerList"
],function (Map, MapView, GeoJSONLayer, ClassBreaksRenderer, LayerList){
    
  var incomeMap = new Map({ 
      basemap: "gray-vector" 
  });

  var incomeView = new MapView({
    container: "incomeMap",
    map: incomeMap,
    center: [-71.4124, 42.03],
    zoom: 6,
    
  });

  var incomeRenderer = new ClassBreaksRenderer({
    field: "Median_Household_Income",
    classBreakInfos: [
      {minValue: 48000, maxValue: 75000, symbol: {type: "simple-fill", color: "#edf8fb"}, label: "< $75k"},
      {minValue: 75000, maxValue: 100000, symbol: {type: "simple-fill", color: "#b2e2e2"}, label: "$75k–$100k"},
      {minValue: 100000, maxValue: 125000, symbol: {type: "simple-fill", color: "#66c2a4"}, label: "$100k–$125k"},
      {minValue: 125000, maxValue: 160000, symbol: {type: "simple-fill", color: "#238b45"}, label: "$125k–$160k"},
      {minValue: 160000, maxValue: 250005, symbol: {type: "simple-fill", color: "#00441b"}, label: "> $160k"}
    ],
      defaultSymbol: {
    type: "simple-fill",
    color: [200, 200, 200, 0.5],
    outline: { color: "white", width: 0.5 }
  },
  defaultLabel: "Data not available"
  });

  var schoolDistricts = new GeoJSONLayer({
    url: "https://raw.githubusercontent.com/joeynads/MA-merged-school-districts-map/refs/heads/main/MASSBYSCHOOLDISTRICTFINAL.json",
    title: "MA School Districts",
    renderer: incomeRenderer,
    popupTemplate: {
      title: "{NAME}",
      content: "Median Household Income: ${Median_Household_Income}"}
  });

  incomeMap.add(schoolDistricts);
    
     var internetMap = new Map({ basemap: "gray-vector" });

  var internetView = new MapView({
    container: "internetMap",
    map: internetMap,
    center: [-71.4124, 42.03],
    zoom: 6,
  });

  var internetRenderer = new ClassBreaksRenderer({
    field: "Percent_of_Households_Without_Internet_Access",
    classBreakInfos: [
      {minValue: 0.239751, maxValue: 2.56909, symbol: {type: "simple-fill", color: "#ffffd4"}, label: "0-2.57%"},
      {minValue: 2.5691, maxValue: 4.432474, symbol: {type: "simple-fill", color: "#fee391"}, label: "2.57%-4.43%"},
      {minValue: 4.432475, maxValue: 6.7, symbol: {type: "simple-fill", color: "#fec44f"}, label: "4.43%-6.7%"},
      {minValue: 6.7, maxValue: 10.016069, symbol: {type: "simple-fill", color: "#fe9929"}, label: "6.7%-10%"},
      {minValue: 10.01607, maxValue: 15.076439, symbol: {type: "simple-fill", color: "#d95f0e"}, label: "10%-15.1%"}
    ],
      defaultSymbol: {
    type: "simple-fill",
    color: [200, 200, 200, 0.5],
    outline: { color: "white", width: 0.5 }
  },
  defaultLabel: "Data not available"
  });

  var internetLayer = new GeoJSONLayer({
    url: "https://raw.githubusercontent.com/joeynads/MA-merged-school-districts-map/refs/heads/main/MASSBYSCHOOLDISTRICTFINAL.json",
    title: "Internet Access",
    renderer: internetRenderer,
    popupTemplate: {
      title: "{NAME}",
      content: "% of Households Without Internet Access: {Percent_of_Households_Without_Internet_Access}%"
    }
  });

  internetMap.add(internetLayer);
    
    var graduatedMap = new Map({ basemap: "gray-vector" });

  var graduatedView = new MapView({
    container: "graduatedMap",
    map: graduatedMap,
    center: [-71.4124, 42.03],
    zoom: 6,
    ui: {components: ["attribution"]}
  });

  var graduatedRenderer = new ClassBreaksRenderer({
    field: "Percent_Graduated_in_4_Years",
    classBreakInfos: [
      {minValue: 64.1, maxValue: 76.6, symbol: {type: "simple-fill", color: "#fee5d9"}, label: "64%-76.6%"},
      {minValue: 76.60001, maxValue: 85.2, symbol: {type: "simple-fill", color: "#fcae91"}, label: "76.6%-85.2%"},
      {minValue: 85.20001, maxValue: 91.6, symbol: {type: "simple-fill", color: "#fb6a4a"}, label: "85.2%-91.6%"},
      {minValue: 91.6001, maxValue: 95.4, symbol: {type: "simple-fill", color: "#de2d26"}, label: "91.6%-95.4%"},
      {minValue: 95.4001, maxValue: 100, symbol: {type: "simple-fill", color: "#a50f15"}, label: "95.4%-100%"}
    ],
      defaultSymbol: {
    type: "simple-fill",
    color: [200, 200, 200, 0.5],
    outline: { color: "white", width: 0.5 }
  },
  defaultLabel: "Data not available"
  });

  var graduatedLayer = new GeoJSONLayer({
    url: "https://raw.githubusercontent.com/joeynads/MA-merged-school-districts-map/refs/heads/main/MASSBYSCHOOLDISTRICTFINAL.json",
    title: "% Graduated in 4 Years",
    renderer: graduatedRenderer,
    popupTemplate: {
      title: "{NAME}",
      content: "% Graduated in Four Years: {Percent_Graduated_in_4_Years}%"
    }
  });

  graduatedMap.add(graduatedLayer);
    
        var passingMap = new Map({ basemap: "gray-vector" });

  var passingView = new MapView({
    container: "passingMap",
    map: passingMap,
    center: [-71.4124, 42.03],
    zoom: 6,
    ui: {components: ["attribution"]}
  });

  var passingRenderer = new ClassBreaksRenderer({
    field: "Percent_Grade_Nine_Passing_All_Courses",
    classBreakInfos: [
      {minValue: 43.6, maxValue: 56.6, symbol: {type: "simple-fill", color: "#eff3ff"}, label: "43.6%-56.6%"},
      {minValue: 56.6001, maxValue: 68.8, symbol: {type: "simple-fill", color: "#bdd7e7"}, label: "56.6%-68.8%"},
      {minValue: 68.8001, maxValue: 82.3, symbol: {type: "simple-fill", color: "#6baed6"}, label: "68.8%-82.3%"},
      {minValue: 82.3001, maxValue: 92.7, symbol: {type: "simple-fill", color: "#3182bd"}, label: "82.3%-92.7%"},
      {minValue: 92.7001, maxValue: 100, symbol: {type: "simple-fill", color: "#08519c"}, label: "92.7%-100%"}
    ],
      defaultSymbol: {
    type: "simple-fill",
    color: [200, 200, 200, 0.5],
    outline: { color: "white", width: 0.5 }
  },
  defaultLabel: "Data not available"
  });

  var passingLayer = new GeoJSONLayer({
    url: "https://raw.githubusercontent.com/joeynads/MA-merged-school-districts-map/refs/heads/main/MASSBYSCHOOLDISTRICTFINAL.json",
    title: "% 9th Grade Students Passing All Courses",
    renderer: passingRenderer,
    popupTemplate: {
      title: "{NAME}",
      content: "% 9th Grade Students Passing All Courses: {Percent_Grade_Nine_Passing_All_Courses}%"
    }
  });

  passingMap.add(passingLayer);
    
    var layerListIncome = new LayerList({
        view: incomeView,
        container: "incomeList",
        listItemCreatedFunction: function(event) {
            const item = event.item;
            if (item.layer.type !== "group") {
                item.panel = {
                    content: "legend",
                    open: true
                };
            }
        }
    });
        
        var layerListInternet = new LayerList({
        view: internetView,
        container: "internetList",
        listItemCreatedFunction: function(event) {
            const item = event.item;
            if (item.layer.type !== "group") {
                item.panel = {
                    content: "legend",
                    open: true
                };
            }
        }
    });
    
    var layerListGraduated = new LayerList({
        view: graduatedView,
        container: "graduatedList",
        listItemCreatedFunction: function(event) {
            const item = event.item;
            if (item.layer.type !== "group") {
                item.panel = {
                    content: "legend",
                    open: true
                };
            }
        }
    });
    
    var layerListPassing = new LayerList({
        view: passingView,
        container: "passingList",
        listItemCreatedFunction: function(event) {
            const item = event.item;
            if (item.layer.type !== "group") {
                item.panel = {
                    content: "legend",
                    open: true
                };
            }
        }
    });
    
    
    const views = [incomeView, internetView, graduatedView, passingView];
            let active;
            
            const sync = (source) => {
                if (!active || !active.viewpoint || active !== source) {
                    return;
                }
                
            for (const view of views) {
                if (view !== active) {
                    view.viewpoint = active.viewpoint
                }
            }
        };
             for (const view of views) {
                 view.watch(["interacting", "animation"], () => {
                     active = view
                     sync(active);
                 });
                 view.watch("viewpoint", () => sync(view));
             }
});
</script>

</head>
    <body>
    <header id="header"> 
        <h1 style="vertical-align: middle">What Factors Affect School Performance in Massachusetts?</h1></header>
        <div id="legendContainer">
            <h2>Legend</h2>
        <div id = "combinedLegend">
            <div id = "incomeList"></div>
            <div id="internetList"></div>
            <div id="graduatedList"></div>
            <div id="passingList"></div>
            </div>
        </div>
        
        <div id="incomeMap">
            <div class = "subtitle">Median Household Income </div>
        </div>
        
        <div id="internetMap">
            <div class = "subtitle">% of Households Without <br> Internet Access</div>
        </div>
        
        <div id="graduatedMap">
            <div class = "subtitle">% Graduated in 4 Years </div>
        </div>
        
        <div id="passingMap">
            <div class = "subtitle">% of 9th Grade Students <br> Passing All Classes</div>
        </div>
        
        </body>
</html>
    